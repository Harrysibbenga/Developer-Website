---
// src/pages/newsletter/unsubscribe/[email].astro
/**
 * Dynamic route for newsletter unsubscription
 * Extracts email from URL path and passes to Vue component
 */

import Layout from '../../../layouts/Layout.astro'
import NewsletterUnsubscribe from '../../../components/newsletter/NewsletterUnsubscribe.vue'
import { BUSINESS_INFO } from '../../../utils/constants'

// Enable SSR for this dynamic route
export const prerender = false

// Required for dynamic routes
export function getStaticPaths() {
  return []
}

const pageTitle = `Unsubscribe from Newsletter - ${BUSINESS_INFO.name}`
const pageDescription = 'Unsubscribe from our newsletter or manage your subscription preferences.'

// Extract email from URL parameter
const { email: emailParam } = Astro.params
const email = emailParam ? decodeURIComponent(emailParam) : ''

// Check for auto-confirm parameter
const autoConfirm = Astro.url.searchParams.get('confirm') === 'true'
---

<Layout 
  title={pageTitle}
  description={pageDescription}
  canonical="/newsletter/unsubscribe"
>
  <NewsletterUnsubscribe client:load email={email} autoConfirm={autoConfirm} />
</Layout>
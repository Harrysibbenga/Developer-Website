---
// src/components/layout/Footer.astro
/**
 * Footer component with business information, links, and social media
 * Professional design with contact information and service areas
 */

 import { BUSINESS_INFO, SERVICES } from '../../utils/constants'
import { Instagram, Linkedin, AtSign} from '@lucide/astro';

const currentYear = new Date().getFullYear()

const quickLinks = [
  { name: 'Home', href: '/' },
  { name: 'Services', href: '/#services' },
  { name: 'Tech Stack', href: '/#tech-stack' },
  { name: 'Portfolio', href: '/#portfolio' },
  { name: 'About', href: '/about' },
  { name: 'Contact', href: '/contact' }
]

const serviceLinks = Object.entries(SERVICES).map(([key, service]) => ({
  name: service.title,
  href: `/services#${key}`
}))

const legalLinks = [
  { name: 'Privacy Policy', href: '/privacy' },
  { name: 'Terms of Service', href: '/terms' },
  { name: 'Cookie Policy', href: '/cookies' }
]

const serviceAreas = BUSINESS_INFO.serviceAreas.slice(0, 6) // Show first 6 areas
---

<footer class="bg-gray-900 text-white relative overflow-hidden">
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-5">
    <div class="grid grid-cols-12 gap-2 h-full">
      {Array.from({ length: 144 }, (_, i) => (
        <div 
          class="bg-blue-400 rounded-sm animate-pulse"
          style={`animation-delay: ${(i * 100)}ms; animation-duration: ${3 + (i % 4)}s`}
        />
      ))}
    </div>
  </div>

  <!-- Main Footer Content -->
  <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      
      <!-- Company Info -->
      <div class="lg:col-span-1 space-y-6">
        <div>
          <!-- Logo and Brand -->
          <a href="/" class="flex items-center space-x-3 mb-6 group">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center shadow-lg group-hover:scale-105 transition-transform duration-300">
              <span class="text-white font-bold text-lg">HS</span>
            </div>
            <div>
              <div class="font-bold text-xl text-white">
                {BUSINESS_INFO.name}
              </div>
              <div class="text-blue-300 text-sm">
                {BUSINESS_INFO.tagline}
              </div>
            </div>
          </a>

          <!-- Description -->
          <p class="text-gray-300 text-sm leading-relaxed mb-6">
            {BUSINESS_INFO.description}
          </p>

          <!-- Contact Information -->
          <div class="space-y-3">
            <div class="flex items-center space-x-3">
              <svg class="w-5 h-5 text-blue-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              <a 
                href={`mailto:${BUSINESS_INFO.contact.email}`}
                class="text-gray-300 hover:text-blue-400 transition-colors"
              >
                {BUSINESS_INFO.contact.email}
              </a>
            </div>
            
            <div class="flex items-center space-x-3">
              <svg class="w-5 h-5 text-blue-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              <a 
                href={`tel:${BUSINESS_INFO.contact.phone}`}
                class="text-gray-300 hover:text-blue-400 transition-colors"
              >
                {BUSINESS_INFO.contact.phone}
              </a>
            </div>
            
            <div class="flex items-start space-x-3">
              <svg class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              <div class="text-gray-300 text-sm leading-relaxed">
                {BUSINESS_INFO.contact.address.area}<br/>
                {BUSINESS_INFO.contact.address.city} {BUSINESS_INFO.contact.address.postcode}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Links -->
      <div class="space-y-6">
        <h3 class="text-lg font-semibold text-white mb-4">
          Quick Links
        </h3>
        <nav class="space-y-3">
          {quickLinks.map((link) => (
            <a
              href={link.href}
              class="block text-gray-300 hover:text-blue-400 transition-colors duration-300 text-sm"
            >
              {link.name}
            </a>
          ))}
        </nav>
      </div>

      <!-- Services -->
      <div class="space-y-6">
        <h3 class="text-lg font-semibold text-white mb-4">
          Services
        </h3>
        <nav class="space-y-3">
          {serviceLinks.map((service) => (
            <a
              href={service.href}
              class="block text-gray-300 hover:text-blue-400 transition-colors duration-300 text-sm"
            >
              {service.name}
            </a>
          ))}
        </nav>
      </div>

      <!-- Service Areas & Business Hours -->
      <div class="space-y-6">
        <div>
          <h3 class="text-lg font-semibold text-white mb-4">
            Service Areas
          </h3>
          <div class="grid grid-cols-2 gap-2">
            {serviceAreas.map((area) => (
              <span class="text-gray-300 text-sm">
                {area}
              </span>
            ))}
          </div>
          <a 
            href="/service-areas" 
            class="inline-block mt-3 text-blue-400 hover:text-blue-300 text-sm transition-colors"
          >
            View all areas →
          </a>
        </div>

        <div>
          <h3 class="text-lg font-semibold text-white mb-4">
            Business Hours
          </h3>
          <div class="space-y-2 text-sm text-gray-300">
            <div class="flex justify-between">
              <span>Mon - Fri:</span>
              <span>{BUSINESS_INFO.businessHours.weekdays}</span>
            </div>
            <div class="flex justify-between">
              <span>Weekends:</span>
              <span>{BUSINESS_INFO.businessHours.weekends}</span>
            </div>
            <div class="text-xs text-gray-400 mt-2">
              Times in {BUSINESS_INFO.businessHours.timezone}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Social Media & Newsletter -->
    <div class="border-t border-gray-800 pt-8 mt-12">
      <div class="grid md:grid-cols-2 gap-8 items-center">
        
        <!-- Social Media Links -->
        <div>
          <h3 class="text-lg font-semibold text-white mb-4">
            Connect With Me
          </h3>
          <div class="flex space-x-4">
            <a
            href={BUSINESS_INFO.social.ticktock}
            target="_blank"
            rel="noopener noreferrer"
            class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center text-gray-400 hover:text-black hover:bg-white transition-all duration-300 group"
            aria-label="TikTok Profile"
            >
            <svg
              class="w-5 h-5 group-hover:scale-110 transition-transform"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 640 640"
              fill="currentColor"
            >
              <path d="M544.5 273.9C500.5 274 457.5 260.3 421.7 234.7L421.7 413.4C421.7 446.5 411.6 478.8 392.7 506C373.8 533.2 347.1 554 316.1 565.6C285.1 577.2 251.3 579.1 219.2 570.9C187.1 562.7 158.3 545 136.5 520.1C114.7 495.2 101.2 464.1 97.5 431.2C93.8 398.3 100.4 365.1 116.1 336C131.8 306.9 156.1 283.3 185.7 268.3C215.3 253.3 248.6 247.8 281.4 252.3L281.4 342.2C266.4 337.5 250.3 337.6 235.4 342.6C220.5 347.6 207.5 357.2 198.4 369.9C189.3 382.6 184.4 398 184.5 413.8C184.6 429.6 189.7 444.8 199 457.5C208.3 470.2 221.4 479.6 236.4 484.4C251.4 489.2 267.5 489.2 282.4 484.3C297.3 479.4 310.4 469.9 319.6 457.2C328.8 444.5 333.8 429.1 333.8 413.4L333.8 64L421.8 64C421.7 71.4 422.4 78.9 423.7 86.2C426.8 102.5 433.1 118.1 442.4 131.9C451.7 145.7 463.7 157.5 477.6 166.5C497.5 179.6 520.8 186.6 544.6 186.6L544.6 274z"/>
            </svg>
            </a>

            <a
              href={BUSINESS_INFO.social.instagram}
              target="_blank"
              rel="noopener noreferrer"
              class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center text-gray-400 hover:text-white hover:bg-red-600 transition-all duration-300 group"
              aria-label="Instagram Profile"
            >
              <Instagram class="w-5 h-5 group-hover:scale-110 transition-transform" />
            </a>
            
            <a
              href={BUSINESS_INFO.social.linkedin}
              target="_blank"
              rel="noopener noreferrer"
              class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center text-gray-400 hover:text-white hover:bg-blue-600 transition-all duration-300 group"
              aria-label="LinkedIn Profile"
            >
              <Linkedin class="w-5 h-5 group-hover:scale-110 transition-transform" />
            </a>
            
            <a
              href={BUSINESS_INFO.social.email}
              class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center text-gray-400 hover:text-white hover:bg-green-600 transition-all duration-300 group"
              aria-label="Send Email"
            >
              <AtSign class="w-5 h-5 group-hover:scale-110 transition-transform" />
            </a>
          </div>
        </div>

        <!-- Newsletter Signup -->
        <div>
          <h3 class="text-lg font-semibold text-white mb-4">
            Stay Updated
          </h3>
          <p class="text-gray-300 text-sm mb-4">
            Get notified about new projects, technical articles, and development insights.
          </p>
          <form id="newsletter-form" class="flex flex-col sm:flex-row gap-3">
            <div class="flex-1">
              <input
                id="newsletter-email"
                type="email"
                placeholder="Enter your email"
                class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                required
              />
              <div id="email-error" class="text-red-400 text-xs mt-1 hidden"></div>
            </div>
            <button
              id="newsletter-submit"
              type="submit"
              class="px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-medium hover:from-blue-700 hover:to-purple-700 transition-all duration-300 whitespace-nowrap"
            >
              Subscribe
            </button>
          </form>
          
          <!-- Error Message -->
          <div id="newsletter-error" class="hidden mt-3 p-3 bg-red-500/20 border border-red-500/50 rounded-lg">
            <p class="text-red-200 text-sm" id="newsletter-error-text"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Legal Entity Information Section -->
    <div class="border-t border-gray-800 pt-8 mt-8">
      <div class="bg-gray-800/50 rounded-xl p-6">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
          <svg class="w-5 h-5 text-blue-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          Legal Entity Information
        </h3>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="text-blue-300 font-medium mb-3">Trading Information</h4>
            <div class="space-y-2 text-sm text-gray-300">
              <div class="flex justify-between">
                <span class="text-gray-400">Trading as:</span>
                <span>{BUSINESS_INFO.fullBusinessName}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Personal Brand:</span>
                <span>{BUSINESS_INFO.name}</span>
              </div>
            </div>
          </div>
          
          <div>
            <h4 class="text-blue-300 font-medium mb-3">Company Details</h4>
            <div class="space-y-2 text-sm text-gray-300">
              <div class="flex justify-between">
                <span class="text-gray-400">Legal Entity:</span>
                <span>{BUSINESS_INFO.legalEntity.name}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Type:</span>
                <span>{BUSINESS_INFO.legalEntity.type}</span>
              </div>
              {BUSINESS_INFO.legalEntity.companyNumber && (
                <div class="flex justify-between">
                  <span class="text-gray-400">Company No:</span>
                  <span class="font-mono">{BUSINESS_INFO.legalEntity.companyNumber}</span>
                </div>
              )}
            </div>
          </div>
        </div>
        
        <div class="mt-6 pt-6 border-t border-gray-700">
          <h4 class="text-blue-300 font-medium mb-3">Registered Office</h4>
          <div class="text-sm text-gray-300">
            <div>{BUSINESS_INFO.legalEntity.registeredOffice.street}</div>
            <div>{BUSINESS_INFO.legalEntity.registeredOffice.area}</div>
            <div>
              {BUSINESS_INFO.legalEntity.registeredOffice.city} {BUSINESS_INFO.legalEntity.registeredOffice.postcode}
            </div>
            <div>{BUSINESS_INFO.legalEntity.registeredOffice.country}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Footer -->
    <div class="border-t border-gray-800 pt-8 mt-8">
      <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
        
        <!-- Copyright -->
        <div class="text-gray-400 text-sm">
          © {currentYear} {BUSINESS_INFO.legalEntity.name}. All rights reserved.
        </div>

        <!-- Legal Links -->
        <nav class="flex flex-wrap justify-center gap-6">
          {legalLinks.map((link) => (
            <a
              href={link.href}
              class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
            >
              {link.name}
            </a>
          ))}
        </nav>

        <!-- Built With -->
        <div class="text-gray-400 text-sm">
          Built with 
          <span class="text-blue-400 font-medium">Astro</span> & 
          <span class="text-green-400 font-medium">Vue.js</span>
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Newsletter Confirmation Modal -->
<div id="newsletter-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
    <div class="p-6 text-center">
      <!-- Success Icon -->
      <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
      </div>
      
      <!-- Title -->
      <h3 class="text-2xl font-bold text-gray-900 mb-4">
        Almost There!
      </h3>
      
      <!-- Message -->
      <div class="text-gray-600 mb-6 space-y-3">
        <p class="text-lg">
          Thanks for subscribing to our newsletter!
        </p>
        <p class="text-sm">
          We've sent a confirmation email to <strong id="confirmed-email" class="text-blue-600"></strong>
        </p>
        <p class="text-sm">
          Please check your inbox and click the confirmation link to complete your subscription.
        </p>
      </div>
      
      <!-- Email Provider Quick Links -->
      <div class="bg-gray-50 rounded-lg p-4 mb-6">
        <p class="text-xs text-gray-500 mb-2">Quick access to email providers:</p>
        <div class="flex flex-wrap justify-center gap-2">
          <a href="https://gmail.com" target="_blank" class="text-xs px-2 py-1 bg-white rounded hover:bg-gray-100 transition-colors">Gmail</a>
          <a href="https://outlook.com" target="_blank" class="text-xs px-2 py-1 bg-white rounded hover:bg-gray-100 transition-colors">Outlook</a>
          <a href="https://yahoo.com" target="_blank" class="text-xs px-2 py-1 bg-white rounded hover:bg-gray-100 transition-colors">Yahoo</a>
          <a href="https://icloud.com" target="_blank" class="text-xs px-2 py-1 bg-white rounded hover:bg-gray-100 transition-colors">iCloud</a>
        </div>
      </div>
      
      <!-- Actions -->
      <button
        id="modal-ok-button"
        class="w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-300"
      >
        Got it!
      </button>
      
      <!-- Small print -->
      <p class="text-xs text-gray-400 mt-4">
        Didn't receive an email? Check your spam folder or contact us for help.
      </p>
    </div>
  </div>
</div>

<style>
  /* Smooth hover transitions */
  footer a {
    transition: all 0.3s ease;
  }
  
  /* Form focus styles */
  footer input:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  /* Newsletter form animations */
  footer form button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  /* Social media hover effects */
  footer .group:hover {
    transform: translateY(-2px);
  }
  
  /* Modal animations */
  #newsletter-modal.show #modal-content {
    transform: scale(1);
    opacity: 1;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    // Import the API client
    const { api, validators } = await import('../../utils/api');
    
    const form = document.getElementById('newsletter-form');
    const emailInput = document.getElementById('newsletter-email');
    const submitButton = document.getElementById('newsletter-submit');
    const emailError = document.getElementById('email-error');
    const errorMessage = document.getElementById('newsletter-error');
    const errorText = document.getElementById('newsletter-error-text');
    const modal = document.getElementById('newsletter-modal');
    const modalContent = document.getElementById('modal-content');
    const confirmedEmail = document.getElementById('confirmed-email');
    const okButton = document.getElementById('modal-ok-button');

    if (!form) return;

    function showEmailError(message) {
      emailError.textContent = message;
      emailError.classList.remove('hidden');
      emailInput.classList.add('border-red-500');
    }

    function clearEmailError() {
      emailError.classList.add('hidden');
      emailInput.classList.remove('border-red-500');
    }

    function showError(message) {
      errorText.textContent = message;
      errorMessage.classList.remove('hidden');
    }

    function clearError() {
      errorMessage.classList.add('hidden');
    }

    function setLoading(loading) {
      if (loading) {
        submitButton.disabled = true;
        submitButton.textContent = 'Subscribing...';
        submitButton.classList.add('opacity-50', 'cursor-not-allowed');
      } else {
        submitButton.disabled = false;
        submitButton.textContent = 'Subscribe';
        submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
      }
    }

    function showModal(email) {
      confirmedEmail.textContent = email;
      modal.classList.remove('hidden');
      setTimeout(() => {
        modal.classList.add('show');
      }, 10);
    }

    function closeModal() {
      modal.classList.remove('show');
      setTimeout(() => {
        modal.classList.add('hidden');
        window.location.reload();
      }, 300);
    }

    // Event listeners
    emailInput.addEventListener('input', () => {
      clearEmailError();
      clearError();
    });

    emailInput.addEventListener('blur', () => {
      const email = emailInput.value.trim();
      if (email) {
        const error = validators.email(email);
        if (error) {
          showEmailError(error);
        }
      }
    });

    okButton.addEventListener('click', closeModal);

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModal();
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = emailInput.value.trim();

      // Validation
      if (!email) {
        showEmailError('Email is required');
        return;
      }

      const emailValidationError = validators.email(email);
      if (emailValidationError) {
        showEmailError(emailValidationError);
        return;
      }

      setLoading(true);
      clearError();

      try {
        // Use your API client to subscribe
        await api.newsletter.subscribe({ email });

        // Success - show modal
        showModal(email);
        emailInput.value = '';

        // Track subscription event (if analytics available)
        if (typeof gtag !== 'undefined') {
          gtag('event', 'newsletter_subscribe', {
            event_category: 'engagement',
            event_label: 'footer_form'
          });
        }

      } catch (error) {
        console.error('Newsletter subscription error:', error);
        
        let errorMessage = 'Something went wrong. Please try again.';
        
        if (error.status === 409) {
          errorMessage = 'This email is already subscribed.';
        } else if (error.status === 422) {
          errorMessage = 'Please enter a valid email address.';
        } else if (error.message) {
          errorMessage = error.message;
        }
        
        showError(errorMessage);
      } finally {
        setLoading(false);
      }
    });
  });
</script>